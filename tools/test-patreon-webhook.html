<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patreon Webhook Tester</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
            color: #fff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            text-align: center;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .method-number {
            background: rgba(255, 255, 255, 0.2);
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .info-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            border-left: 4px solid #fbbf24;
        }

        .info-box strong {
            color: #fbbf24;
        }

        .code-box {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.875rem;
            overflow-x: auto;
            margin: 1rem 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .input-group {
            margin: 1rem 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-family: inherit;
            font-size: 1rem;
        }

        .input-group textarea {
            font-family: 'Monaco', 'Courier New', monospace;
            min-height: 200px;
            resize: vertical;
        }

        .input-group input::placeholder,
        .input-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            width: 100%;
            margin-top: 1rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .result-box {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.875rem;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .result-success {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.5);
        }

        .result-error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.5);
        }

        .step-list {
            list-style: none;
            padding-left: 0;
        }

        .step-list li {
            padding: 0.75rem;
            margin: 0.5rem 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            border-left: 4px solid #667eea;
        }

        .step-list li strong {
            color: #fbbf24;
        }

        .webhook-url {
            background: #1e1e1e;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .webhook-url input {
            flex: 1;
            background: transparent;
            border: none;
            color: #60a5fa;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.875rem;
        }

        .copy-btn {
            padding: 0.5rem 1rem;
            background: rgba(96, 165, 250, 0.2);
            border: 1px solid #60a5fa;
            border-radius: 0.25rem;
            color: #60a5fa;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
        }

        .copy-btn:hover {
            background: rgba(96, 165, 250, 0.3);
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîó Patreon Webhook Tester</h1>
        <p class="subtitle">Test your Patreon webhook integration with ease</p>

        <!-- Method 1: Patreon Developer Portal -->
        <div class="card">
            <div class="section-title">
                <span class="method-number">1</span>
                <span>Test in Patreon Developer Portal (Recommended)</span>
            </div>
            
            <div class="info-box">
                <strong>‚ö° Best Method:</strong> Use Patreon's built-in testing tools to send real webhook events
            </div>

            <div class="webhook-url">
                <input type="text" id="webhookUrl" value="https://patreonwebhook-k5tf6cilcq-uc.a.run.app" readonly>
                <button class="copy-btn" onclick="copyWebhookUrl()">üìã Copy</button>
            </div>

            <ul class="step-list">
                <li><strong>1.</strong> Go to <a href="https://www.patreon.com/portal/registration/register-clients" target="_blank" style="color: #60a5fa;">Patreon Developer Portal</a></li>
                <li><strong>2.</strong> Select your OAuth Client</li>
                <li><strong>3.</strong> Add the webhook URL above to "Webhooks" section</li>
                <li><strong>4.</strong> Subscribe to these events:
                    <ul style="margin-left: 2rem; margin-top: 0.5rem;">
                        <li>‚úì members:pledge:create</li>
                        <li>‚úì members:pledge:update</li>
                        <li>‚úì members:pledge:delete</li>
                    </ul>
                </li>
                <li><strong>5.</strong> Click "Send Test" button for each event</li>
                <li><strong>6.</strong> Check Firebase Console logs for webhook processing</li>
            </ul>

            <a href="https://console.firebase.google.com/project/vixvvowebsite/functions/logs" target="_blank">
                <button class="btn">üìä View Firebase Logs</button>
            </a>
        </div>

        <!-- Method 2: Manual cURL Test -->
        <div class="card">
            <div class="section-title">
                <span class="method-number">2</span>
                <span>Manual cURL Test</span>
            </div>
            
            <div class="info-box">
                <strong>‚ö†Ô∏è Note:</strong> This will fail signature verification, but you can see if the endpoint is reachable
            </div>

            <div class="input-group">
                <label for="eventType">Webhook Event Type:</label>
                <select id="eventType">
                    <option value="members:pledge:create">members:pledge:create (New Member)</option>
                    <option value="members:pledge:update">members:pledge:update (Update Member)</option>
                    <option value="members:pledge:delete">members:pledge:delete (Cancel Member)</option>
                </select>
            </div>

            <div class="code-box" id="curlCommand"></div>

            <button class="btn btn-secondary" onclick="copyCurlCommand()">üìã Copy cURL Command</button>
        </div>

        <!-- Method 3: Custom Tester -->
        <div class="card">
            <div class="section-title">
                <span class="method-number">3</span>
                <span>Send Custom Test Webhook</span>
            </div>

            <div class="input-group">
                <label for="customEvent">Event Type:</label>
                <select id="customEvent">
                    <option value="members:pledge:create">members:pledge:create</option>
                    <option value="members:pledge:update">members:pledge:update</option>
                    <option value="members:pledge:delete">members:pledge:delete</option>
                </select>
            </div>

            <div class="input-group">
                <label for="customPayload">Webhook Payload (JSON):</label>
                <textarea id="customPayload" placeholder='{"data": {...}}'></textarea>
            </div>

            <button class="btn" onclick="sendCustomWebhook()">üöÄ Send Test Webhook</button>

            <div id="customResult"></div>
        </div>

        <!-- Method 4: Real Test -->
        <div class="card">
            <div class="section-title">
                <span class="method-number">4</span>
                <span>Real-World Test</span>
            </div>

            <ul class="step-list">
                <li><strong>Test with Real Account:</strong> Link your Patreon account on the website</li>
                <li><strong>Check Database:</strong> Verify membership data is synced to Firebase</li>
                <li><strong>Change Tier:</strong> Update your Patreon pledge amount</li>
                <li><strong>Verify Update:</strong> Check if webhook updates your membership tier</li>
                <li><strong>Cancel/Reactivate:</strong> Test pledge cancellation and reactivation</li>
            </ul>

            <button class="btn" onclick="openFirebaseConsole()">üîç Open Firebase Database</button>
        </div>
    </div>

    <script>
        // Initialize with sample payload
        const samplePayload = {
            data: {
                attributes: {
                    patron_status: "active_patron",
                    currently_entitled_amount_cents: 1000
                },
                id: "12345678",
                type: "member",
                relationships: {
                    user: {
                        data: {
                            id: "user_123",
                            type: "user"
                        }
                    },
                    currently_entitled_tiers: {
                        data: [
                            {
                                id: "tier_123",
                                type: "tier"
                            }
                        ]
                    }
                }
            }
        };

        document.getElementById('customPayload').value = JSON.stringify(samplePayload, null, 2);

        // Update cURL command when event type changes
        document.getElementById('eventType').addEventListener('change', updateCurlCommand);
        updateCurlCommand();

        function updateCurlCommand() {
            const eventType = document.getElementById('eventType').value;
            const curlCmd = `curl -X POST https://patreonwebhook-k5tf6cilcq-uc.a.run.app \\
  -H "Content-Type: application/json" \\
  -H "X-Patreon-Event: ${eventType}" \\
  -H "X-Patreon-Signature: test-signature" \\
  -d '${JSON.stringify(samplePayload)}'`;
            
            document.getElementById('curlCommand').textContent = curlCmd;
        }

        function copyWebhookUrl() {
            const url = document.getElementById('webhookUrl');
            url.select();
            document.execCommand('copy');
            alert('‚úÖ Webhook URL copied to clipboard!');
        }

        function copyCurlCommand() {
            const curlCmd = document.getElementById('curlCommand').textContent;
            navigator.clipboard.writeText(curlCmd).then(() => {
                alert('‚úÖ cURL command copied! Paste it in your terminal.');
            });
        }

        async function sendCustomWebhook() {
            const event = document.getElementById('customEvent').value;
            const payload = document.getElementById('customPayload').value;
            const resultDiv = document.getElementById('customResult');

            try {
                const payloadObj = JSON.parse(payload);
                
                resultDiv.innerHTML = '<div class="result-box" style="background: rgba(96, 165, 250, 0.2); border: 1px solid #60a5fa;">‚è≥ Sending webhook...</div>';

                const response = await fetch('https://patreonwebhook-k5tf6cilcq-uc.a.run.app', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Patreon-Event': event,
                        'X-Patreon-Signature': 'test-signature'
                    },
                    body: JSON.stringify(payloadObj)
                });

                const responseText = await response.text();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="result-box result-success">
                            ‚úÖ Status: ${response.status} ${response.statusText}
                            
Response: ${responseText}

Note: This likely failed signature verification but reached the endpoint.
Check Firebase logs to see webhook processing.
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="result-box result-error">
                            ‚ùå Status: ${response.status} ${response.statusText}
                            
Response: ${responseText}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result-box result-error">
                        ‚ùå Error: ${error.message}
                    </div>
                `;
            }
        }

        function openFirebaseConsole() {
            window.open('https://console.firebase.google.com/project/vixvvowebsite/database/vixvvowebsite-default-rtdb/data', '_blank');
        }
    </script>
</body>
</html>
